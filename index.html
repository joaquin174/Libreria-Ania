<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>INVENTARIO LIBRERIA ANIA</title>
  <style>
    body {
      margin: 0;
      padding: 2em;
      font-family: 'Segoe UI', sans-serif;
      background: transparent;
      color: #00ffff;
      backdrop-filter: blur(12px);
    }

    h1 {
      text-align: center;
      text-shadow: 0 0 10px #00ffff;
      margin-bottom: 1em;
    }

    .top-bar {
      text-align: center;
      margin-bottom: 2em;
    }

    .producto {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(0, 0, 0, 0.4);
      padding: 1em;
      margin-bottom: 1em;
      border-radius: 10px;
      box-shadow: 0 0 8px #00ffff;
    }

    button {
      background: linear-gradient(145deg, #00ffff, #00cccc);
      border: none;
      border-radius: 10px;
      padding: 0.6em 1.2em;
      color: #003333;
      font-weight: bold;
      box-shadow: 0 4px #008080;
      cursor: pointer;
    }

    #alertas {
      position: fixed;
      bottom: 1em;
      right: 1em;
      max-width: 300px;
      z-index: 10000;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
    }

    .alerta {
      background: rgba(255, 0, 0, 0.9);
      color: #fff;
      margin-top: 1em;
      padding: 1em;
      border-radius: 10px;
      box-shadow: 0 0 10px red;
      font-weight: bold;
      animation: aparecer 0.3s ease;
    }

    @keyframes aparecer {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .alerta button {
      margin-top: 0.5em;
      background: #fff;
      color: #b30000;
      box-shadow: none;
      padding: 0.4em 0.8em;
    }
  </style>
</head>
<body>

  <div class="top-bar">
    <h1>INVENTARIO LIBRERIA ANIA</h1>
    <button onclick="window.open('vender_celular.html', '_blank')">Vender en celular</button>
  </div>

  <div id="productos"></div>
  <div id="alertas"></div>

  <script>
    const MINIMO = 2;
    const MAXIMO = 12;
    let productos = [
      { id: 1, nombre: "Producto 1", stock: 12 },
      { id: 2, nombre: "Producto 2", stock: 12 },
      { id: 3, nombre: "Producto 3", stock: 12 }
    ];

    let alertasActivas = new Set();
    const productosDiv = document.getElementById('productos');
    const alertasDiv = document.getElementById('alertas');

    function guardarProductos() {
      localStorage.setItem('productos', JSON.stringify(productos));
    }

    function cargarProductos() {
      const data = localStorage.getItem('productos');
      if (data) {
        productos = JSON.parse(data);
      }
    }

    function renderProductos() {
      productosDiv.innerHTML = '';
      productos.forEach(p => {
        const div = document.createElement('div');
        div.className = 'producto';
        div.innerHTML = `
          <span>${p.nombre} - Stock: ${p.stock}</span>
          <button onclick="vender(${p.id})">Vender</button>
        `;
        productosDiv.appendChild(div);
      });
    }

    function vender(id) {
      const p = productos.find(prod => prod.id === id);
      if (p && p.stock > MINIMO) {
        p.stock--;
        guardarProductos();
        renderProductos();
        verificarAlerta(p);
      }
    }

    function verificarAlerta(p) {
      if (p.stock <= MINIMO && !alertasActivas.has(p.id)) {
        crearAlerta(p);
        alertasActivas.add(p.id);
      }
    }

    function crearAlerta(p) {
      const div = document.createElement('div');
      div.className = 'alerta';
      div.id = `alerta-${p.id}`;
      div.innerHTML = `
        ðŸ”” ALERTA: ${p.nombre} en stock mÃ­nimo (${p.stock})<br>
        <button onclick="cerrarAlerta(${p.id})">Cerrar y reiniciar</button>
      `;
      alertasDiv.appendChild(div);
      reproducirAlertaVoz(p);
    }

    function cerrarAlerta(id) {
      const p = productos.find(prod => prod.id === id);
      if (p) {
        p.stock = MAXIMO;
        guardarProductos();
        renderProductos();
      }
      const alerta = document.getElementById(`alerta-${id}`);
      if (alerta) alerta.remove();
      alertasActivas.delete(id);
      speechSynthesis.cancel();
    }

    function reproducirAlertaVoz(p) {
      let count = 0;
      const mensaje = new SpeechSynthesisUtterance(`Alerta de inventario: Producto ${p.nombre}, quedan ${p.stock} unidades`);
      mensaje.onend = () => {
        count++;
        if (count < 3) speechSynthesis.speak(mensaje);
      };
      speechSynthesis.speak(mensaje);
    }

    // SincronizaciÃ³n desde la otra pÃ¡gina
    window.addEventListener('storage', e => {
      if (e.key === 'productos') {
        cargarProductos();
        renderProductos();
        productos.forEach(p => verificarAlerta(p));
      }
      if (e.key === 'alertaProducto') {
        const alerta = JSON.parse(localStorage.getItem('alertaProducto'));
        if (alerta && alerta.stock <= MINIMO && !alertasActivas.has(alerta.id)) {
          const p = productos.find(prod => prod.id === alerta.id);
          if (p) {
            crearAlerta(p);
            alertasActivas.add(p.id);
          }
        }
      }
    });

    function iniciar() {
      cargarProductos();
      renderProductos();
      productos.forEach(p => {
        if (p.stock <= MINIMO) verificarAlerta(p);
      });
    }

    iniciar();
  </script>

</body>
</html>
